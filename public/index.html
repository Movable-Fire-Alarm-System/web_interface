<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Cease Fire Web Interface</title>
  <script src="/js/vue3.0.5.js"></script>
  <link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/css/bootstrap.min.css">
  <!-- <link rel="stylesheet" href="/css/bootstrap.min.css"> -->
  <link rel="stylesheet" href="/css/style.css">
  <script src="https://cdn.staticfile.org/jquery/2.1.1/jquery.min.js"></script>
  <script src="https://cdn.staticfile.org/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
  <!-- <script type="text/javascript" src="http://static.robotwebtools.org/EventEmitter2/current/eventemitter2.min.js"></script> -->
  <!-- <script type="text/javascript" src="http://static.robotwebtools.org/roslibjs/current/roslib.min.js"></script> -->
  <!-- <script src="/js/jquery.min.js"></script> -->
  <!-- <script src="/js/bootstrap.min.js"></script> -->
  <script type="text/javascript" src="/js/eventemitter2.min.js"></script>
  <script type="text/javascript" src="/js/roslib.min.js"></script>

</head>

<body>

  <nav class="navbar navbar-default" role="navigation">
    <div class="navbar-header">
      <a class="navbar-brand" href="https://github.com/Movable-Fire-Alarm-System">Cease Fire Web Interface</a>
    </div>
  </nav>



  <div class="container-fluid">
    <div class="row clearfix">
      <div class="col-md-6 column">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3>Movement Control</h3>
          </div>
          <div class="panel-body">
            <!-- 
            <div class="row clearfix">
              <div class="col-md-12 column"> -->
            <img src="http://10.17.79.127:8080/stream?topic=/cam_1/color/image_raw" class="img-responsive img-thumbnail rotate180">
            <!-- </div>
            </div> -->

            <div id="movementApp">
              <div class="row clearfix spacer">
                <div class="col-md-6 column">
                  <label class="radio-inline">
                    <input type="radio" name="movementMode" v-model="movementMode" id="movementModeOption1" value="auto"
                      onchange="movementMode(this)"> Auto
                  </label>
                </div>
                <div class="col-md-6 column">
                  <label class="radio-inline">
                    <input type="radio" name="movementMode" v-model="movementMode" id="movementModeOption2"
                      value="manual" onchange="movementMode(this)"> Manual
                  </label>
                </div>
              </div>

              <div>
                <div class="row clearfix">
                  <div class="col-md-6 column">

                  </div>
                  <div class="col-md-1 column">
                    <button type="button" class="btn btn-default" v-bind:disabled="movementMode === 'auto'"
                      onmousedown="movementUpStart()" onmouseup="movementUpEnd()">
                      <span class="glyphicon glyphicon-arrow-up"></span>
                    </button>
                  </div>
                  <div class="col-md-1 column">

                  </div>
                </div>
                <div class="row clearfix">
                  <div class="col-md-5 column">

                  </div>
                  <div class="col-md-1 column">
                    <button type="button" class="btn btn-default" v-bind:disabled="movementMode === 'auto'"
                      onmousedown="movementLeftStart()" onmouseup="movementLeftEnd()">
                      <span class="glyphicon glyphicon-arrow-left"></span>
                    </button>
                  </div>
                  <div class="col-md-1 column">

                  </div>
                  <div class="col-md-1 column">
                    <button type="button" class="btn btn-default" v-bind:disabled="movementMode === 'auto'"
                      onmousedown="movementRightStart()" onmouseup="movementRightEnd()">
                      <span class="glyphicon glyphicon-arrow-right"></span>
                    </button>
                  </div>
                </div>
                <div class="row clearfix">
                  <div class="col-md-6 column">

                  </div>
                  <div class="col-md-1 column">
                    <button type="button" class="btn btn-default" v-bind:disabled="movementMode === 'auto'"
                      onmousedown="movementDownStart()" onmouseup="movementDownEnd()">
                      <span class="glyphicon glyphicon-arrow-down"></span>
                    </button>
                  </div>
                  <div class="col-md-1 column">

                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <div class="col-md-6 column">
        <div class="panel panel-default">
          <div class="panel-heading">
            <h3>Gimbal Control</h3>
          </div>
          <div class="panel-body">

            <!-- <div class="row clearfix">
              <div class="col-md-12 column"> -->
            <img src="http://10.17.79.127:8080/stream?topic=/cam_2/color/image_raw" class="img-responsive img-thumbnail rotate180">
            <!-- <img src="http://10.17.79.127:8080/stream?topic=/darknet_ros/detection_image" class="img-responsive img-thumbnail"> -->
            <!-- </div>
            </div> -->

            <div id="gimbalApp">


              <div class="row clearfix spacer">
                <div class="col-md-6 column">
                  <label class="radio-inline">
                    <input type="radio" name="gimbalMode" v-model="gimbalMode" id="gimbalModeOption1" value="auto"
                      onchange="gimbalMode(this)"> Auto
                  </label>
                </div>
                <div class="col-md-6 column">
                  <label class="radio-inline">
                    <input type="radio" name="gimbalMode" v-model="gimbalMode" id="gimbalModeOption2" value="manual"
                      onchange="gimbalMode(this)"> Manual
                  </label>
                </div>
              </div>

              <div class="row clearfix">
                <div class="col-md-6 column">

                </div>
                <div class="col-md-1 column">
                  <button type="button" class="btn btn-default" v-bind:disabled="gimbalMode === 'auto'"
                    onclick="gimbalUp()">
                    <span class="glyphicon glyphicon-arrow-up"></span>
                  </button>
                </div>
                <div class="col-md-1 column">

                </div>
              </div>
              <div class="row clearfix">
                <div class="col-md-5 column">

                </div>
                <div class="col-md-1 column">
                  <button type="button" class="btn btn-default" v-bind:disabled="gimbalMode === 'auto'"
                  onclick="gimbalLeft()">
                    <span class="glyphicon glyphicon-arrow-left"></span>
                  </button>
                </div>
                <div class="col-md-1 column">

                </div>
                <div class="col-md-1 column">
                  <button type="button" class="btn btn-default" v-bind:disabled="gimbalMode === 'auto'"
                  onclick="gimbalDown()">
                    <span class="glyphicon glyphicon-arrow-right"></span>
                  </button>
                </div>
                <div class="col-md-4 column">
                  <button type="button" class="btn btn-default" v-bind:disabled="gimbalMode === 'auto'"
                  onclick="gimbalLeft()">
                    shoot
                  </button>
                </div>
              </div>
              <div class="row clearfix">
                <div class="col-md-6 column">

                </div>
                <div class="col-md-1 column">
                  <button type="button" class="btn btn-default" v-bind:disabled="gimbalMode === 'auto'"
                    onmousedown="gimbalDownStart()" onmouseup="gimbalDownEnd()">
                    <span class="glyphicon glyphicon-arrow-down"></span>
                  </button>
                </div>
                <div class="col-md-1 column">

                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- <div class="container-fluid">
  <div class="row clearfix">
    <div class="col-md-6 column">
      <a href="https://www.sustech.edu.cn/">
        <img src="/image/SUSTech-Logo.png" class="img-responsive" alt="SUSTech">
      </a>
    </div>
    <div class="col-md-6 column">
      <a href="https://isee.technology/">
        <img src="/image/ISEE-Lab-Logo_vz.svg" class="img-responsive" alt="ISEE">
      </a>
    </div>
  </div>
  </div> -->

  <script>

    var movementApp = Vue.createApp({
      data() {
        return {
          movementMode: "auto",
        };
      },
    });

    movementApp.mount("#movementApp");

    var gimbalApp = Vue.createApp({
      data() {
        return {
          gimbalMode: "auto",
        };
      },
    });

    gimbalApp.mount("#gimbalApp")

    var ros = new ROSLIB.Ros({
      url: 'ws://10.17.79.127:9090'
    });

    ros.on('connection', function () {
      console.log('Connected to websocket server.');
    });

    var cmdVel = new ROSLIB.Topic({
      ros: ros,
      name: '/cmd_vel',
      messageType: 'geometry_msgs/Twist'
    });

    var forward = new ROSLIB.Message({
      linear: {
        x: 0.1,
        y: 0.0,
        z: 0.0
      },
      angular: {
        x: 0.0,
        y: 0.0,
        z: 0.0
      }
    });

    var backward = new ROSLIB.Message({
      linear: {
        x: -0.1,
        y: 0.0,
        z: 0.0
      },
      angular: {
        x: 0.0,
        y: 0.0,
        z: 0.0
      }
    });

    var leftTurn = new ROSLIB.Message({
      linear: {
        x: 0.0,
        y: 0.0,
        z: 0.0
      },
      angular: {
        x: 0.0,
        y: 0.0,
        z: 0.1
      }
    });

    var rightTurn = new ROSLIB.Message({
      linear: {
        x: 0.0,
        y: 0.0,
        z: 0.0
      },
      angular: {
        x: 0.0,
        y: 0.0,
        z: -0.1
      }
    });

    var stopVel = new ROSLIB.Message({
      linear: {
        x: 0,
        y: 0,
        z: 0
      },
      angular: {
        x: 0,
        y: 0,
        z: 0
      }
    });

    var gimbal_horizon = new ROSLIB.Topic({
      ros: ros,
      name: '/gimbal/horizon',
      messageType: 'std_msgs/Int16'
    });

    var gimbal_vertical = new ROSLIB.Topic({
      ros: ros,
      name: '/gimbal/vertical',
      messageType: 'std_msgs/Int16'
    });

    var gimbal_up = new ROSLIB.Message({
      data: 5
    });

    var gimbal_down = new ROSLIB.Message({
      data: -5
    });

    var gimbal_left = new ROSLIB.Message({
      data: -5
    })

    var gimbal_right = new ROSLIB.Message({
      data: 5
    })


    var movementUpTimer;
    function movementUpStart() {
      movementUpTimer = setInterval(function () {
        console.log("Moving Up");
        cmdVel.publish(forward);
      }, 1);
    }
    function movementUpEnd() {
      clearInterval(movementUpTimer);
      console.log("Stop");
      cmdVel.publish(stopVel);
    }
    var movementDownTimer;
    function movementDownStart() {
      movementDownTimer = setInterval(function () {
        console.log("Moving Down");
        cmdVel.publish(backward);
      }, 1);
    }
    function movementDownEnd() {
      clearInterval(movementDownTimer);
      console.log("Stop");
      cmdVel.publish(stopVel);
    }
    var movementLeftTimer;
    function movementLeftStart() {
      movementLeftTimer = setInterval(function () {
        console.log("Moving Left");
        cmdVel.publish(leftTurn);
      }, 1);
    }
    function movementLeftEnd() {
      clearInterval(movementLeftTimer);
      console.log("Stop");
      cmdVel.publish(stopVel);
    }
    var movementRightTimer;
    function movementRightStart() {
      movementRightTimer = setInterval(function () {
        console.log("Moving Right");
        cmdVel.publish(rightTurn);
      }, 1);
    }
    function movementRightEnd() {
      clearInterval(movementRightTimer);
      console.log("Stop");
      cmdVel.publish(stopVel);
    }

    function gimbalUp() {
      gimbal_vertical.publish(gimbal_up);
    }

    function gimbalDown() {
      gimbal_vertical.publish(gimbal_down);
    }

    function gimbalLeft() {
      gimbal_horizon.publish(gimbal_left);
    }

    function gimbalRight() {
      gimbal_horizon.publish(gimbal_right);
    }

    function movementMode(select) {
      console.log("Movement Mode:" + select.value);
    }

    function gimbalMode(select) {
      console.log("Gimbal Mode:" + select.value);
    }

  </script>
</body>

</html>
